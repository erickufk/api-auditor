# API Security Auditor

Автоматизированная платформа для проведения комплексного аудита безопасности REST API с использованием искусственного интеллекта.

## Описание проекта

API Security Auditor - это интеллектуальный инструмент для выявления уязвимостей в REST API, который использует AI-агентов на базе Google Gemini для автоматического тестирования безопасности. Система поддерживает как автоматический режим с AI-агентами, так и ручное тестирование отдельных эндпоинтов.

### Основные возможности

- **Два режима тестирования:**
  - **Агентный режим (Agentic Mode)**: AI-агент автономно исследует API, генерирует тестовые сценарии и выполняет итеративное тестирование
  - **Ручной режим (Manual Mode)**: Тестирование отдельных эндпоинтов с детальным анализом запросов и ответов

- **Поддержка различных методов аутентификации:**
  - Bearer Token
  - API Key (в заголовках или query-параметрах)
  - Basic Authentication
  - OAuth 2.0
  - Возможность выполнения запросов аутентификации и автоматического извлечения токенов
  - Поддержка cURL команд для настройки аутентификации и верификации
  - Автоматическое извлечение токенов из ответов API по указанному пути (например, "data.token")
  - Верификация токенов через тестовые запросы с полной поддержкой cURL формата

- **Интеллектуальный анализ безопасности:**
  - Выявление уязвимостей по OWASP API Security Top 10
  - Автоматическая генерация proof-of-concept эксплойтов
  - Оценка критичности по шкале CVSS
  - Рекомендации по устранению уязвимостей
  - Тестирование без аутентификации для выявления открытых эндпоинтов
  - Детальные отчеты по каждой итерации тестирования с информацией о запросах и ответах
  - Экспорт полного текстового отчета (TXT) со всеми найденными уязвимостями

- **Поддержка форматов:**
  - OpenAPI/Swagger спецификации (JSON/YAML)
  - Ручной ввод эндпоинтов
  - Парсинг cURL команд (включая многострочные с backslash-продолжениями)
  - Парсинг raw HTTP запросов

- **Многоязычный интерфейс:**
  - Русский
  - Английский

## Архитектура решения

### Технологический стек

**Frontend:**
- Next.js 16 (App Router)
- React 19.2
- TypeScript 5
- Tailwind CSS 4
- shadcn/ui компоненты

**Backend:**
- Next.js API Routes
- Server Actions

**AI/ML:**
- Google Gemini (через Vercel AI SDK)
- AI SDK 5.0

**Дополнительные библиотеки:**
- Zod (валидация схем)
- React Hook Form (управление формами)
- date-fns (работа с датами)
- Recharts (визуализация данных)

### Структура проекта

\`\`\`
api-security-auditor/
├── app/
│   ├── api/                          # API Routes
│   │   ├── analyze-agentic-iteration/ # Анализ итераций агентного тестирования
│   │   ├── analyze-manual-test/       # Анализ ручных тестов
│   │   ├── execute-auth/              # Прокси для выполнения аутентификации
│   │   └── test-endpoint/             # Прокси для тестирования эндпоинтов
│   ├── layout.tsx                     # Корневой layout
│   ├── page.tsx                       # Главная страница с основным workflow
│   └── globals.css                    # Глобальные стили
│
├── components/
│   ├── ui/                            # shadcn/ui компоненты
│   ├── landing-page.tsx               # Лендинг
│   ├── welcome-step.tsx               # Шаг приветствия
│   ├── mode-selection-step.tsx        # Выбор режима тестирования
│   ├── project-mode-step.tsx          # Выбор типа проекта
│   ├── auth-config-step.tsx           # Настройка аутентификации
│   ├── agentic-config-step.tsx        # Настройка агентного режима
│   ├── manual-config-step.tsx         # Настройка ручного режима
│   ├── report-display.tsx             # Отображение отчета
│   ├── progress-tracker.tsx           # Трекер прогресса
│   └── header.tsx                     # Шапка приложения
│
├── lib/
│   ├── types.ts                       # TypeScript типы и интерфейсы
│   ├── agentic-workflow.ts            # Логика агентного тестирования
│   ├── manual-test-workflow.ts        # Логика ручного тестирования
│   ├── openapi-parser.ts              # Парсер OpenAPI спецификаций
│   ├── auth-token-extractor.ts        # Утилиты для извлечения токенов из ответов
│   ├── fuzzing-engine.tsx             # Движок для фаззинга
│   ├── open-doors-detector.ts         # Детектор открытых эндпоинтов
│   ├── translations.ts                # Переводы интерфейса
│   ├── session-storage.ts             # Управление сессиями
│   └── utils.ts                       # Утилиты
│
└── public/                            # Статические файлы
\`\`\`

### Архитектура компонентов

#### 1. Workflow Engine

Система использует пошаговый workflow для проведения аудита:

\`\`\`
Landing → Welcome → Mode Selection → Project Mode → Auth Config → Test Config → Testing → Report
\`\`\`

Каждый шаг управляется через состояние в главном компоненте `app/page.tsx`.

#### 2. Агентный режим (Agentic Workflow)

\`\`\`typescript
// Основной цикл агентного тестирования
runAgenticWorkflow(initialRequest, config) {
  1. Выполнить начальный запрос
  2. Проанализировать ответ с помощью Gemini
  3. Получить список follow-up тестов
  4. Для каждой итерации (до maxIterations):
     - Выполнить тест
     - Проанализировать результат
     - Выявить уязвимости
     - Сгенерировать новые тесты
     - Проверить условия остановки
  5. Сформировать итоговый отчет
}
\`\`\`

**Ключевые особенности:**
- Итеративное тестирование с обучением на предыдущих результатах
- Автоматическая генерация тестовых сценариев
- Адаптивная стратегия тестирования (low/medium/high aggressiveness)
- Остановка при обнаружении критических уязвимостей

#### 3. Ручной режим (Manual Workflow)

\`\`\`typescript
// Процесс ручного тестирования
analyzeManualTest(testData) {
  1. Получить request/response пару
  2. Отправить на анализ в Gemini
  3. Выявить уязвимости
  4. Сгенерировать рекомендации
  5. Предложить follow-up тесты
  6. Вернуть детальный отчет
}
\`\`\`

**Ключевые особенности:**
- Тестирование одного эндпоинта за раз
- Детальный анализ каждого запроса
- Возможность тестировать новые эндпоинты без перезапуска
- Сохранение конфигурации аутентификации

#### 4. Система аутентификации

Поддерживает полный цикл аутентификации с расширенными возможностями:

\`\`\`typescript
// Процесс аутентификации
1. Пользователь вводит данные для аутентификации (форма или cURL команда)
2. Система выполняет запрос к auth endpoint
3. Автоматически извлекает токен из ответа по указанному пути
4. Токен используется во всех последующих запросах
5. Опциональная верификация токена через тестовый эндпоинт (поддержка cURL)
\`\`\`

**Поддерживаемые методы:**
- **Bearer Token**: Токен в заголовке `Authorization: Bearer <token>`
- **API Key**: Ключ в заголовке или query-параметре
- **Basic Auth**: Username/password в заголовке
- **OAuth 2.0**: Client credentials flow
- **Raw Request/cURL**: Полная поддержка cURL команд с автоматическим парсингом
  - Многострочные команды с backslash-продолжениями
  - Автоматическое извлечение URL, метода, заголовков и тела запроса
  - Поддержка флагов `-X`, `-H`, `-d`, `--data`

**Извлечение токенов:**
- Автоматическое извлечение токенов из JSON ответов по указанному пути
- Поддержка вложенных структур (например, `data.auth.access_token`)
- Автоматическое применение извлеченных токенов к Bearer или OAuth конфигурации
- Визуальное подтверждение успешного извлечения токена

#### 5. Proxy Architecture

Все внешние запросы проходят через серверные API routes для обхода CORS:

\`\`\`
Client → /api/execute-auth → External API
Client → /api/test-endpoint → External API
\`\`\`

Это позволяет:
- Обходить CORS ограничения
- Логировать все запросы
- Добавлять дополнительную обработку
- Обеспечивать безопасность

### Типы уязвимостей

Система выявляет уязвимости согласно OWASP API Security Top 10:

1. **Broken Object Level Authorization (BOLA/IDOR)**
2. **Broken Authentication**
3. **Broken Object Property Level Authorization**
4. **Unrestricted Resource Consumption**
5. **Broken Function Level Authorization**
6. **Unrestricted Access to Sensitive Business Flows**
7. **Server Side Request Forgery (SSRF)**
8. **Security Misconfiguration**
9. **Improper Inventory Management**
10. **Unsafe Consumption of APIs**

### Формат отчета

Система генерирует детальный отчет в формате:

\`\`\`typescript
{
  scan_id: string
  timestamp: string
  api_name: string
  overall_risk_score: "critical" | "high" | "medium" | "low" | "info"
  endpoints_scanned: number
  vulnerabilities_found: number
  vulnerabilities: [
    {
      id: string
      title: string
      severity: "critical" | "high" | "medium" | "low" | "info"
      description: string
      affected_endpoints: string[]
      proof_of_concept: string
      remediation: string
      cwe_id: string
      cvss_score: number
    }
  ]
  agenticResult?: {
    iterations: [
      {
        iteration: number
        request: { url, method, headers, body }
        response: { status, body, headers }
        analysis: string
        vulnerabilitiesFound: Vulnerability[]
      }
    ]
  }
  summary: {
    critical: number
    high: number
    medium: number
    low: number
    info: number
  }
  recommendations: string[]
}
\`\`\`

### Экспорт отчетов

Система поддерживает экспорт отчетов в следующих форматах:

**JSON отчет:**
- Полная структура данных со всеми деталями
- Включает метаинформацию, уязвимости, итерации тестирования
- Подходит для интеграции с другими системами

**TXT отчет:**
- Человекочитаемый текстовый формат
- Включает всю информацию из JSON плюс детальные описания
- Структурированный формат с разделами:
  - Информация о проекте
  - Протестированные эндпоинты
  - Найденные уязвимости с PoC
  - Итерации агентного тестирования (запросы и ответы)
  - Рекомендации по устранению
- Единая структура для всех типов тестирования

## Использование

### Агентный режим

1. Выберите "Agentic Mode" на экране выбора режима
2. Загрузите OpenAPI спецификацию или введите эндпоинт вручную
3. Настройте аутентификацию (если требуется)
4. Настройте параметры агента:
   - Максимальное количество итераций
   - Уровень агрессивности
   - Условия остановки
5. Запустите тестирование
6. Дождитесь завершения и изучите отчет

### Ручной режим

1. Выберите "Manual Mode" на экране выбора режима
2. Настройте аутентификацию (если требуется)
3. Введите детали запроса:
   - URL эндпоинта
   - HTTP метод
   - Заголовки
   - Query параметры
   - Тело запроса
4. Выполните запрос
5. Изучите детальный анализ
6. При необходимости протестируйте другие эндпоинты

### Настройка аутентификации

#### Вариант 1: Использование формы

1. Включите "Login Flow" если требуется получить токен
2. Выберите метод аутентификации (Bearer, API Key, Basic, OAuth)
3. Введите endpoint для получения токена
4. Заполните необходимые параметры (в зависимости от метода)
5. Укажите путь для извлечения токена (например, `access_token` или `data.token`)
6. Нажмите "Execute Authentication"
7. Система автоматически извлечет и применит токен

#### Вариант 2: Использование cURL команды

1. Скопируйте cURL команду из документации API или браузера
2. Вставьте команду в поле "Raw Request (Optional)"
3. Система автоматически распарсит:
   - URL эндпоинта
   - HTTP метод
   - Заголовки
   - Тело запроса
4. Укажите путь для извлечения токена
5. Нажмите "Execute Authentication"

**Пример cURL команды:**
\`\`\`bash
curl -X 'POST' \
  'https://api.example.com/auth/token' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "client_id": "your_client_id",
  "client_secret": "your_secret"
}'
\`\`\`

#### Верификация токена

1. Опционально: укажите эндпоинт для верификации
2. Можно использовать форму или вставить cURL команду
3. Нажмите "Verify Token"
4. Система протестирует токен и покажет результат:
   - 200 OK: токен действителен
   - 401/403: проблемы с аутентификацией
   - 404: токен работает, но ресурс не найден (нормально)

#### Тестирование без аутентификации

Система поддерживает тестирование без аутентификации для выявления:
- Открытых эндпоинтов без защиты
- Неправильно настроенной авторизации
- Утечек информации в error messages

Просто выберите "None" в методах аутентификации и начните тестирование. Ответы 401/403 являются валидными результатами тестирования и предоставляют ценную информацию о безопасности API.

## Особенности работы с отчетами

### Просмотр результатов

- **Endpoints Tested**: Консолидированный список всех протестированных эндпоинтов с количеством найденных проблем
- **Vulnerabilities Found**: Детальная информация о каждой уязвимости с горизонтальной прокруткой для длинных PoC
- **Agentic Testing Iterations**: Полная история тестирования с запросами и ответами (с горизонтальной прокруткой)
- **Summary Cards**: Быстрая статистика по уровням критичности

### Навигация

- **Test Another Endpoint**: Протестировать дополнительный эндпоинт без перезапуска (сохраняет настройки аутентификации)
- **New Audit**: Начать новый аудит с начала
- **Export Reports**: Скачать результаты в JSON или TXT формате

### Оптимизация производительности

Система оптимизирована для работы с большими объемами данных:
- Использование `useMemo` для предотвращения лишних пересчетов
- Ленивая загрузка компонентов
- Эффективный рендеринг списков
- Предотвращение зависания при прокрутке больших отчетов

## API Endpoints

### POST /api/execute-auth

Прокси для выполнения запросов аутентификации.

**Request:**
\`\`\`json
{
  "url": "string",
  "method": "POST" | "GET",
  "headers": {},
  "body": "string"
}
\`\`\`

**Response:**
\`\`\`json
{
  "status": number,
  "statusText": "string",
  "headers": {},
  "body": "string"
}
\`\`\`

### POST /api/test-endpoint

Прокси для тестирования эндпоинтов.

**Request:**
\`\`\`json
{
  "url": "string",
  "method": "string",
  "headers": {},
  "queryParams": {},
  "body": "string"
}
\`\`\`

**Response:**
\`\`\`json
{
  "status": number,
  "statusText": "string",
  "headers": {},
  "body": "string"
}
\`\`\`

### POST /api/analyze-manual-test

Анализ результатов ручного теста.

**Request:**
\`\`\`json
{
  "request": ManualTestRequest,
  "response": ManualTestResponse
}
\`\`\`

**Response:** SecurityReport

### POST /api/analyze-agentic-iteration

Анализ итерации агентного тестирования.

**Request:**
\`\`\`json
{
  "request": ManualTestRequest,
  "response": ManualTestResponse,
  "previousIterations": AgenticIteration[],
  "aggressiveness": "low" | "medium" | "high",
  "iterationNumber": number
}
\`\`\`

**Response:**
\`\`\`json
{
  "analysis": "string",
  "vulnerabilitiesFound": Vulnerability[],
  "reasoning": "string",
  "shouldContinue": boolean,
  "followUpTests": FollowUpTest[]
}
\`\`\`

## Безопасность

- Все внешние запросы проходят через серверные API routes
- API ключи хранятся только на сервере
- Поддержка всех стандартных методов аутентификации
- Логирование всех запросов для аудита

## Ограничения

- Требуется Google Generative AI API ключ
- Ограничения rate limiting зависят от API провайдера
- Агентный режим может занимать продолжительное время при большом количестве итераций
- Многострочные cURL команды должны использовать backslash (\) для продолжения строк
- Максимальная глубина вложенности для извлечения токенов ограничена разумными пределами

## Roadmap

- [ ] Поддержка GraphQL API
- [ ] Интеграция с CI/CD пайплайнами
- [x] Экспорт отчетов в TXT формате
- [ ] Экспорт отчетов в PDF/HTML
- [ ] Сохранение истории аудитов
- [ ] Сравнение результатов между аудитами
- [ ] Поддержка дополнительных AI моделей
- [ ] Автоматическое обнаружение эндпоинтов
- [ ] Поддержка HAR файлов для импорта запросов
- [ ] Автоматическое определение метода извлечения токенов
- [ ] Поддержка refresh tokens
- [ ] Визуализация дерева эндпоинтов

## Лицензия

MIT

## Контакты

Для вопросов и предложений создавайте issues в репозитории.
